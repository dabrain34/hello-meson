# hello-meson

This small example demonstrates on how to strip symbols from an archive generated by two different
source files, a.c and b.c.

This commands will remove the `a_foo` symbol from the final library:

```
$ meson -C build -Dstripped-symbols=a_foo -Doptimize-gc-sections=True
$ ninja -C build -v
```

It uses a linker script `build/public_symbols.lds` autogenerated with the command `-Dstripped-symbols=a_foo`.

Seen that a_foo is in the same section as a_bar, the `-Doptimize-gc-sections=True` is also used to create
a section by functions using `-fdata-sections -ffunction-sections`.

If you dont want to use `-fdata-sections -ffunction-sections` then you
have to strip all the symbols from the object file such as:

```
$ meson -C build -Dstripped-symbols=a_foo:a_bar
```

In addition two important linker flags are used here:

 * `-Wl,--gc-sections`: It collects unused sections so it will be responsible to strip the dead code
 * `-Wl,--whole-archive libstatic-hello-lib.a -Wl,--end-group -Wl,--no-whole-archive`: It exposes all the symbols
 from the archive. These linker flags are only necessary in the case of the use of an object's archive
